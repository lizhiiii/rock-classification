# å²©çŸ³åˆ†ç±»é¡¹ç›® (Rock Classification)

åŸºäºæ·±åº¦å­¦ä¹ çš„å²©çŸ³å›¾åƒåˆ†å±‚åˆ†ç±»ç³»ç»Ÿï¼Œä½¿ç”¨ConvNeXtV2-Largeä¸»å¹²ç½‘ç»œå®ç°é«˜ç²¾åº¦ä¸‰åˆ†ç±»è¯†åˆ«ã€‚

## ğŸ† é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªå…ˆè¿›çš„å²©çŸ³å›¾åƒåˆ†ç±»ç³»ç»Ÿï¼Œé‡‡ç”¨å±‚æ¬¡åŒ–åˆ†ç±»ç­–ç•¥ï¼ŒåŒæ—¶é¢„æµ‹çˆ¶ç±»ï¼ˆ3ç±»ï¼‰å’Œå­ç±»ï¼ˆè¯¦ç»†ç±»åˆ«ï¼‰ã€‚é€šè¿‡ä½¿ç”¨æœ€æ–°çš„ConvNeXtV2-Largeé¢„è®­ç»ƒæ¨¡å‹ä½œä¸ºç‰¹å¾æå–å™¨ï¼Œç»“åˆå¤šç§æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œå®ç°äº†**81.47%**çš„éªŒè¯å‡†ç¡®ç‡ã€‚

### ä¸»è¦ç‰¹ç‚¹
- **å…ˆè¿›æ¶æ„**: ConvNeXtV2-Largeä¸»å¹²ç½‘ç»œ + åŒå¤´åˆ†ç±»å™¨
- **å±‚æ¬¡åˆ†ç±»**: åŒæ—¶é¢„æµ‹ç²—ç²’åº¦çˆ¶ç±»å’Œç»†ç²’åº¦å­ç±»
- **é«˜çº§æŠ€æœ¯**: æ··åˆç²¾åº¦è®­ç»ƒã€æŒ‡æ•°ç§»åŠ¨å¹³å‡(EMA)ã€æ ‡ç­¾å¹³æ»‘
- **æ•°æ®å¢å¼º**: RandAugment + MixUp/CutMix
- **æµ‹è¯•æ—¶å¢å¼º**: å¤šå°ºåº¦ + æ°´å¹³ç¿»è½¬TTA

## ğŸ“Š æ€§èƒ½è¡¨ç°

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æœ€ä½³éªŒè¯å‡†ç¡®ç‡ | **81.47%** |
| è®­ç»ƒæ•°æ®é›† | 102,213å¼ å›¾åƒ |
| éªŒè¯æ•°æ®é›† | 15,000å¼ å›¾åƒ |
| å­ç±»æ€»æ•° | 19,160ç±» |
| è®­ç»ƒè®¾å¤‡ | NVIDIA L20 |

## ğŸ“ é¡¹ç›®ç»“æ„

```
rock-classification/
â”œâ”€â”€ README.md                 # ğŸ“‹ é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ main.ipynb               # ğŸ”‘ ä¸»è®­ç»ƒå’Œæ¨ç†ä»£ç 
â”œâ”€â”€ requirements.txt          # ğŸ“¦ Pythonä¾èµ–åŒ…
â”œâ”€â”€ config.py                # âš™ï¸ é…ç½®æ–‡ä»¶
â”œâ”€â”€ train_log.csv            # ğŸ“ˆ è®­ç»ƒå†å²è®°å½•
â”œâ”€â”€ submission.csv           # ğŸ“„ ç”Ÿæˆçš„æäº¤æ–‡ä»¶
â”œâ”€â”€ è¯¦ç»†è¦æ±‚.md              # ğŸ“ é¡¹ç›®è¦æ±‚è¯´æ˜
â”œâ”€â”€ é¡¹ç›®ä»‹ç».pdf             # ğŸ“– é¡¹ç›®ä»‹ç»æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md            # ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—
â”œâ”€â”€ LICENSE                  # ğŸ“œ è®¸å¯è¯
â”œâ”€â”€ .gitignore              # ğŸš« Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ checkpoint/             # ğŸ“ æ¨¡å‹æ£€æŸ¥ç‚¹ç›®å½•ï¼ˆç©ºï¼‰
â”œâ”€â”€ logs/                   # ğŸ“ æ—¥å¿—ç›®å½•
â”œâ”€â”€ data/                   # ğŸ“ æ•°æ®ç›®å½•ï¼ˆç©ºï¼‰
â”œâ”€â”€ src/                    # ğŸ“ æºä»£ç ç›®å½•
â”‚   â””â”€â”€ __init__.py
â””â”€â”€ scripts/                # ğŸ“ è„šæœ¬ç›®å½•
    â”œâ”€â”€ setup.sh            # ç¯å¢ƒè®¾ç½®è„šæœ¬
    â”œâ”€â”€ train.sh            # è®­ç»ƒè„šæœ¬
    â””â”€â”€ inference.sh        # æ¨ç†è„šæœ¬
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“ å—ç§‘å¤§ç»Ÿè®¡ä¸æ•°æ®ç§‘å­¦ç³»ç”¨æˆ·

**å¦‚æœæ‚¨æ˜¯å—ç§‘å¤§ç»Ÿè®¡ä¸æ•°æ®ç§‘å­¦ç³»ç›¸å…³äººå‘˜ï¼š**

1. **ç›´æ¥ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨**
   ```bash
   # å°†main.ipynbä¸Šä¼ åˆ°: /shareddata/project/dataset/
   cd /shareddata/project/dataset
   ```

2. **å®‰è£…ä¾èµ–åº“**
   ```bash
   pip install -r requirements.txt
   ```

3. **ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹**
   ```bash
   # ä¸‹è½½ConvNeXtV2-Largeé¢„è®­ç»ƒæ¨¡å‹åˆ°å½“å‰ç›®å½•
   wget -O convnextv2_large.fcmae_ft_in22k_in1k_384.bin \
     "https://dl.fbaipublicfiles.com/convnext/convnextv2/im22k/convnextv2_large_22k_384_ema.pt"
   ```

4. **å¼€å§‹è®­ç»ƒ**
   ```bash
   jupyter notebook main.ipynb
   # æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰å•å…ƒæ ¼å³å¯å¼€å§‹è®­ç»ƒ
   ```

---

### ğŸŒ å…¶ä»–ç”¨æˆ·ä½¿ç”¨æŒ‡å—

**å¦‚æœæ‚¨ä¸æ˜¯å—ç§‘å¤§ç»Ÿè®¡ä¸æ•°æ®ç§‘å­¦ç³»äººå‘˜ï¼š**

### 1. ç¯å¢ƒé…ç½®

```bash
git clone https://github.com/your-username/rock-classification.git
cd rock-classification
```

**ä½¿ç”¨Conda (æ¨è)**
```bash
conda create -n rock-cls python=3.10
conda activate rock-cls
pip install -r requirements.txt
```

**ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ**
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows
pip install -r requirements.txt
```

### 2. âš ï¸ é‡è¦ï¼šè·¯å¾„ä¿®æ”¹

**ç”±äºmain.ipynbä¸­ç¡¬ç¼–ç äº†æœåŠ¡å™¨è·¯å¾„ï¼Œéå—ç§‘å¤§ç”¨æˆ·å¿…é¡»ä¿®æ”¹è·¯å¾„ï¼**

æ‰“å¼€ `main.ipynb`ï¼Œæ‰¾åˆ°ç¬¬2ä¸ªä»£ç å•å…ƒæ ¼ï¼Œå°†ï¼š
```python
# åŸå§‹è·¯å¾„ï¼ˆæœåŠ¡å™¨ä¸“ç”¨ï¼‰
DATA_ROOT = "/shareddata/project/dataset"
```

ä¿®æ”¹ä¸ºï¼š
```python
# ä¿®æ”¹ä¸ºæœ¬åœ°è·¯å¾„
DATA_ROOT = "data"  # æˆ–æ‚¨çš„æ•°æ®å­˜æ”¾è·¯å¾„
```

### 3. æ•°æ®é›†ä¸‹è½½

**é€šè¿‡ç½‘ç›˜ä¸‹è½½å®Œæ•´æ•°æ®é›†ï¼š**

ğŸ”— **æ•°æ®é›†ä¸‹è½½åœ°å€**: https://pan.quark.cn/s/6dc546e5aae4#/list/share

ä¸‹è½½åï¼ŒæŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡æ•°æ®ï¼š
```
data/
â”œâ”€â”€ train_val/
â”‚   â”œâ”€â”€ train/              # è®­ç»ƒå›¾åƒ (102,213å¼ )
â”‚   â”œâ”€â”€ val/                # éªŒè¯å›¾åƒ (15,000å¼ )
â”‚   â”œâ”€â”€ train_labels.csv    # è®­ç»ƒæ ‡ç­¾
â”‚   â””â”€â”€ val_labels.csv      # éªŒè¯æ ‡ç­¾
â””â”€â”€ test/
    â”œâ”€â”€ test_images/        # æµ‹è¯•å›¾åƒ
    â””â”€â”€ test_ids.csv        # æµ‹è¯•ID
```

### 4. æ¨¡å‹æ–‡ä»¶è·å–

#### 4.1 é¢„è®­ç»ƒæ¨¡å‹ä¸‹è½½
```bash
# ä»å®˜ç½‘ä¸‹è½½ConvNeXtV2-Largeé¢„è®­ç»ƒæ¨¡å‹
wget -O convnextv2_large.fcmae_ft_in22k_in1k_384.bin \
  "https://dl.fbaipublicfiles.com/convnext/convnextv2/im22k/convnextv2_large_22k_384_ema.pt"
```

#### 4.2 æœ€ä½³è®­ç»ƒæ¨¡å‹ä¸‹è½½ï¼ˆå¯é€‰ï¼‰
å¦‚æœæ‚¨æƒ³ç›´æ¥ä½¿ç”¨å·²è®­ç»ƒå¥½çš„æœ€ä½³æ¨¡å‹ï¼š

ğŸ”— **æœ€ä½³æ¨¡å‹ä¸‹è½½**: https://pan.baidu.com/s/1w3FRDxs_puIBaLQitGWxzA?pwd=vbxu  
**æå–ç **: `vbxu`

ä¸‹è½½ `best_parent_0.8185.pth` å¹¶æ”¾å…¥ `checkpoint/` ç›®å½•ã€‚

### 5. å¼€å§‹è®­ç»ƒ
```bash
jupyter notebook main.ipynb
# æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰å•å…ƒæ ¼
```

## ğŸ“ˆ è®­ç»ƒç»“æœåˆ†æ

### æ€§èƒ½æŒ‡æ ‡
æ ¹æ® `train_log.csv` è®°å½•ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­çš„å…³é”®æŒ‡æ ‡ï¼š

- **æœ€ä½³çˆ¶ç±»å‡†ç¡®ç‡**: 81.47% (Epoch 15)
- **è®­ç»ƒæ—¶é—´**: çº¦19åˆ†é’Ÿ/epoch (NVIDIA L20)
- **æ”¶æ•›æƒ…å†µ**: åœ¨å‰15ä¸ªepochå†…è¾¾åˆ°æœ€ä½³æ€§èƒ½
- **æ•°æ®å¢å¼ºæ•ˆæœ**: MixUp/CutMixåœ¨å‰80%è®­ç»ƒæœŸé—´æœ‰æ•ˆ

### è®­ç»ƒæ›²çº¿ç‰¹ç‚¹
- å­¦ä¹ ç‡è°ƒåº¦ï¼šçº¿æ€§é¢„çƒ­ + ä½™å¼¦é€€ç«
- æŸå¤±ä¸‹é™ç¨³å®šï¼Œä»0.8023é™è‡³0.6401
- éªŒè¯å‡†ç¡®ç‡ç¨³æ­¥æå‡ï¼Œä»69.30%å‡è‡³81.47%
- EMAæŠ€æœ¯æœ‰æ•ˆæå‡æ¨¡å‹æ³›åŒ–èƒ½åŠ›

## âš™ï¸ æŠ€æœ¯ç»†èŠ‚

### æ¨¡å‹æ¶æ„
```python
# ä¸»å¹²ç½‘ç»œ
backbone = ConvNeXtV2-Large (é¢„è®­ç»ƒäºImageNet-22K)
# åˆ†ç±»å¤´
head_parent = Linear(feat_dim, 3)      # çˆ¶ç±»åˆ†ç±»å™¨
head_child = Linear(feat_dim, 19160)   # å­ç±»åˆ†ç±»å™¨
```

### æ ¸å¿ƒæŠ€æœ¯
- **æ··åˆç²¾åº¦è®­ç»ƒ**: AMPåŠ é€Ÿè®­ç»ƒï¼ŒèŠ‚çœæ˜¾å­˜
- **æŒ‡æ•°ç§»åŠ¨å¹³å‡**: EMAæƒé‡å¹³æ»‘ï¼Œæå‡æ³›åŒ–æ€§èƒ½
- **æµ‹è¯•æ—¶å¢å¼º**: å¤šå°ºåº¦(224,256,288) + æ°´å¹³ç¿»è½¬
- **æ•°æ®å¢å¼º**: RandAugment + MixUp/CutMixç»„åˆ
- **æ ‡ç­¾å¹³æ»‘**: 0.1å¹³æ»‘ç³»æ•°ï¼Œå‡å°‘è¿‡æ‹Ÿåˆ

### è®­ç»ƒé…ç½®
| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| Batch Size | 64 | æ‰¹æ¬¡å¤§å° |
| Learning Rate | 4e-5 | ä¸»å¹²ç½‘ç»œå­¦ä¹ ç‡ |
| Weight Decay | 1e-4 | æƒé‡è¡°å‡ |
| Warm Epochs | 5 | é¢„çƒ­è½®æ•° |
| EMA Decay | 0.9999 | æŒ‡æ•°ç§»åŠ¨å¹³å‡è¡°å‡ |

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. CUDAå†…å­˜ä¸è¶³**
```python
# ä¿®æ”¹main.ipynbä¸­çš„æ‰¹æ¬¡å¤§å°
BATCH_SIZE = 32  # æˆ–æ›´å°
```

**2. è·¯å¾„é”™è¯¯**
```python
# ç¡®ä¿ä¿®æ”¹äº†DATA_ROOTè·¯å¾„
DATA_ROOT = "data"  # æœ¬åœ°è·¯å¾„
```

**3. æ¨¡å‹æ–‡ä»¶ç¼ºå¤±**
```bash
# ç¡®ä¿ä¸‹è½½äº†é¢„è®­ç»ƒæ¨¡å‹
ls -la convnextv2_large.fcmae_ft_in22k_in1k_384.bin
```

**4. ä¾èµ–åº“é—®é¢˜**
```bash
# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt --force-reinstall
```

## ğŸ“Š æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶
- `main.ipynb`: å®Œæ•´çš„è®­ç»ƒå’Œæ¨ç†ä»£ç 
- `train_log.csv`: è¯¦ç»†çš„è®­ç»ƒå†å²è®°å½•
- `requirements.txt`: é¡¹ç›®ä¾èµ–åŒ…åˆ—è¡¨
- `config.py`: é…ç½®å‚æ•°ï¼ˆå®é™…ä»¥main.ipynbä¸ºå‡†ï¼‰

### ç”Ÿæˆæ–‡ä»¶
- `submission.csv`: æµ‹è¯•é›†é¢„æµ‹ç»“æœ
- `checkpoint/best_parent_*.pth`: æœ€ä½³æ¨¡å‹æƒé‡
- `train_log.csv`: è®­ç»ƒè¿‡ç¨‹æ—¥å¿—

## ğŸ”— èµ„æºé“¾æ¥

### æ•°æ®å’Œæ¨¡å‹è·å–
- **æ•°æ®é›†**: https://pan.quark.cn/s/6dc546e5aae4#/list/share
- **æœ€ä½³æ¨¡å‹**: https://pan.baidu.com/s/1w3FRDxs_puIBaLQitGWxzA?pwd=vbxu (æå–ç : vbxu)
- **é¢„è®­ç»ƒæ¨¡å‹**: https://dl.fbaipublicfiles.com/convnext/convnextv2/im22k/convnextv2_large_22k_384_ema.pt

### å‚è€ƒèµ„æ–™
- ConvNeXtV2 è®ºæ–‡: https://arxiv.org/abs/2301.00808
- timm æ¨¡å‹åº“: https://github.com/rwightman/pytorch-image-models
- PyTorch EMA: https://github.com/fadel/pytorch_ema

## ğŸ“ ä½¿ç”¨æ­¥éª¤æ€»ç»“

1. **å…‹éš†é¡¹ç›®** â†’ `git clone ...`
2. **å®‰è£…ç¯å¢ƒ** â†’ `pip install -r requirements.txt`
3. **ä¿®æ”¹è·¯å¾„** â†’ ç¼–è¾‘main.ipynbä¸­çš„DATA_ROOT
4. **ä¸‹è½½æ•°æ®** â†’ ä»ç½‘ç›˜è·å–æ•°æ®é›†
5. **ä¸‹è½½æ¨¡å‹** â†’ è·å–é¢„è®­ç»ƒæ¨¡å‹æ–‡ä»¶
6. **å¼€å§‹è®­ç»ƒ** â†’ `jupyter notebook main.ipynb`
7. **ç”Ÿæˆç»“æœ** â†’ è¿è¡Œæ¨ç†å•å…ƒæ ¼å¾—åˆ°submission.csv

## ğŸ¤ è´¡çŒ®ä¸è”ç³»

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
- æäº¤ GitHub Issue
- å‘é€é‚®ä»¶è”ç³»é¡¹ç›®ç»´æŠ¤è€…

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

â­ **å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStarï¼** â­ 